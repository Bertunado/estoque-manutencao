{% extends "base.html" %}

{% block content %}
<main class="flex-1 p-4 md:p-8">
    <h1 class="text-3xl font-bold text-gray-800">Carrinho de Retirada</h1>
    <p class="text-gray-500 mt-1 mb-8">Confira os itens selecionados antes de confirmar.</p>

    <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
        <form action="{% url 'estoque:confirmar_retirada' %}" method="post">
            {% csrf_token %}
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">Itens selecionados</h2>
                <span id="contador-carrinho" class="bg-blue-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">{{ itens_no_carrinho|length }}</span>
            </div>
            
            <div id="carrinho-container" data-update-url="{% url 'estoque:atualizar_quantidade' %}">
                {% for item_data in itens_no_carrinho %}
                <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-lg mb-2 carrinho-item" data-item-id="{{ item_data.item.id }}">
                    <img class="w-16 h-16 object-cover rounded-lg" src="{{ item_data.item.imagem.url }}" alt="{{ item_data.item.nome }}">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800 text-sm">{{ item_data.item.nome }}</h4>
                        <p class="text-xs text-gray-500">Código: {{ item_data.item.codigo }}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <select class="form-select text-sm p-1 border rounded-md w-16">
                            {% for i in "x"|rjust:item_data.item.disponivel|slice:":5" %}
                               <option value="{{ forloop.counter }}" {% if forloop.counter == item_data.quantidade %}selected{% endif %}>{{ forloop.counter }}</option>
                            {% endfor %}
                        </select>
                        <button type="button" class="btn-remover text-gray-400 hover:text-red-500 transition-colors"><svg ...></svg></button>
                    </div>
                </div>
                {% empty %}
                <div id="carrinho-vazio" class="text-center text-gray-500 h-full flex flex-col items-center justify-center">
                    <h3 class="mt-4 text-lg font-semibold text-gray-800">Carrinho vazio</h3>
                </div>
                {% endfor %}
            </div>
            
            <div class="mt-6 border-t pt-6">
                <div class="flex justify-between items-center text-lg font-bold text-gray-800 mb-4">
                    <span>Total:</span>
                    <span id="carrinho-total">R$ {{ valor_total_carrinho|floatformat:2 }}</span>
                </div>
                <label for="observacao" class="block text-sm font-medium text-gray-700 mb-2">Observação (opcional)</label>
                <textarea id="observacao" name="observacao" class="w-full p-2 border border-gray-300 rounded-lg h-24 focus:ring-brand-blue-600 focus:border-brand-blue-600"></textarea>
                <button type="submit" class="w-full mt-4 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">Confirmar retirada</button>
                <button type="button" id="limpar-carrinho-btn" class="w-full mt-2 bg-white text-gray-700 py-3 rounded-lg border border-gray-300 hover:bg-gray-100 font-semibold" data-limpar-url="{% url 'estoque:limpar_carrinho' %}">Limpar Seleção</button>
            </div>
        </form>
    </div>
</main>
{% endblock %}